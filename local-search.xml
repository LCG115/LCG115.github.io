<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>17.星系</title>
    <link href="/2022/09/17/threejs/17-%E6%98%9F%E7%B3%BB/"/>
    <url>/2022/09/17/threejs/17-%E6%98%9F%E7%B3%BB/</url>
    
    <content type="html"><![CDATA[<p><a href="https://lcg778.github.io">查看自旋效果</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入three.js</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">// 调试组件</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dat.gui&#x27;</span><br><br><span class="hljs-comment">// 创建调试组件</span><br><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> dat.<span class="hljs-title function_">GUI</span>(&#123; <span class="hljs-attr">width</span>: <span class="hljs-number">360</span> &#125;)<br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 加载纹理</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建画布</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 银河系</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> parameters = &#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-number">10000</span>,<br>  <span class="hljs-attr">size</span>: <span class="hljs-number">0.01</span>,<br>  <span class="hljs-attr">radius</span>: <span class="hljs-number">5</span>,<br>  <span class="hljs-attr">branches</span>: <span class="hljs-number">3</span>,<br>  <span class="hljs-attr">spin</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">randomness</span>: <span class="hljs-number">0.02</span>,<br>  <span class="hljs-attr">randomnessPower</span>: <span class="hljs-number">3</span>,<br>  <span class="hljs-attr">insideColor</span>: <span class="hljs-string">&#x27;#ff6030&#x27;</span>,<br>  <span class="hljs-attr">outsideColor</span>: <span class="hljs-string">&#x27;#1b3984&#x27;</span>,<br>  <span class="hljs-attr">vertexColors</span>: <span class="hljs-literal">true</span><br>&#125;<br><br><span class="hljs-keyword">let</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">BufferGeometry</span><br><span class="hljs-keyword">let</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">PointsMaterial</span><br><span class="hljs-keyword">let</span> points = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">Points</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">generateGalaxy</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span>(points !== <span class="hljs-literal">null</span>) &#123;<br>    geometry.<span class="hljs-title function_">dispose</span>()<br>    material.<span class="hljs-title function_">dispose</span>()<br>    scene.<span class="hljs-title function_">remove</span>(points)<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> positions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(parameters.<span class="hljs-property">count</span> * <span class="hljs-number">3</span>)<br>  <span class="hljs-keyword">const</span> colors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(parameters.<span class="hljs-property">count</span> * <span class="hljs-number">3</span>)<br><br>  <span class="hljs-keyword">const</span> colorInside = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(parameters.<span class="hljs-property">insideColor</span>)<br>  <span class="hljs-keyword">const</span> colorOutside = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(parameters.<span class="hljs-property">outsideColor</span>)<br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; parameters.<span class="hljs-property">count</span>; i++) &#123;<br>    <span class="hljs-keyword">const</span> i3 = i * <span class="hljs-number">3</span><br><br>    <span class="hljs-keyword">const</span> radius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * parameters.<span class="hljs-property">radius</span><br>    <span class="hljs-keyword">const</span> spinAngle = radius * parameters.<span class="hljs-property">spin</span><br>    <span class="hljs-keyword">const</span> brancAngle = (i % parameters.<span class="hljs-property">branches</span>) / parameters.<span class="hljs-property">branches</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span><br><br>    <span class="hljs-keyword">const</span> randomX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(), parameters.<span class="hljs-property">randomnessPower</span>) * (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">1</span> : - <span class="hljs-number">1</span>) * parameters.<span class="hljs-property">randomness</span> * radius<br>    <span class="hljs-keyword">const</span> randomY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(), parameters.<span class="hljs-property">randomnessPower</span>) * (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">1</span> : - <span class="hljs-number">1</span>) * parameters.<span class="hljs-property">randomness</span> * radius<br>    <span class="hljs-keyword">const</span> randomZ = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(), parameters.<span class="hljs-property">randomnessPower</span>) * (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">1</span> : - <span class="hljs-number">1</span>) * parameters.<span class="hljs-property">randomness</span> * radius<br><br>    positions[i3    ] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(brancAngle + spinAngle) * radius + randomX<br>    positions[i3 + <span class="hljs-number">1</span>] = randomY<br>    positions[i3 + <span class="hljs-number">2</span>] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(brancAngle + spinAngle) * radius + randomZ<br><br>    <span class="hljs-keyword">const</span> mixedColor = colorInside.<span class="hljs-title function_">clone</span>()<br>    mixedColor.<span class="hljs-title function_">lerp</span>(colorOutside, radius / parameters.<span class="hljs-property">radius</span>)<br><br>    colors[i3    ] = mixedColor.<span class="hljs-property">r</span><br>    colors[i3 + <span class="hljs-number">1</span>] = mixedColor.<span class="hljs-property">g</span><br>    colors[i3 + <span class="hljs-number">2</span>] = mixedColor.<span class="hljs-property">b</span><br>  &#125;<br><br>  geometry.<span class="hljs-title function_">setAttribute</span>(<br>    <span class="hljs-string">&#x27;position&#x27;</span>,<br>    <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(positions, <span class="hljs-number">3</span>)<br>  )<br>  geometry.<span class="hljs-title function_">setAttribute</span>(<br>    <span class="hljs-string">&#x27;color&#x27;</span>,<br>    <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(colors, <span class="hljs-number">3</span>)<br>  )<br><br>  material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointsMaterial</span>(&#123;<br>    <span class="hljs-attr">size</span>: parameters.<span class="hljs-property">size</span>,<br>    <span class="hljs-attr">sizeAttenuation</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">depthWrite</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">blending</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">AdditiveBlending</span>,<br>    <span class="hljs-attr">vertexColors</span>: <span class="hljs-literal">true</span><br>  &#125;)<br><br>  points = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Points</span>(<br>    geometry,<br>    material<br>  )<br><br>  scene.<span class="hljs-title function_">add</span>(points)<br>&#125;<br><br><span class="hljs-title function_">generateGalaxy</span>()<br><br>gui.<span class="hljs-title function_">add</span>(parameters, <span class="hljs-string">&#x27;count&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">onFinishChange</span>(generateGalaxy)<br>gui.<span class="hljs-title function_">add</span>(parameters, <span class="hljs-string">&#x27;size&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0.001</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">0.1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>).<span class="hljs-title function_">onFinishChange</span>(generateGalaxy)<br>gui.<span class="hljs-title function_">add</span>(parameters, <span class="hljs-string">&#x27;radius&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0.01</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.01</span>).<span class="hljs-title function_">onFinishChange</span>(generateGalaxy)<br>gui.<span class="hljs-title function_">add</span>(parameters, <span class="hljs-string">&#x27;branches&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">2</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">onFinishChange</span>(generateGalaxy)<br>gui.<span class="hljs-title function_">add</span>(parameters, <span class="hljs-string">&#x27;spin&#x27;</span>).<span class="hljs-title function_">min</span>(-<span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>).<span class="hljs-title function_">onFinishChange</span>(generateGalaxy)<br>gui.<span class="hljs-title function_">add</span>(parameters, <span class="hljs-string">&#x27;randomness&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">2</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>).<span class="hljs-title function_">onFinishChange</span>(generateGalaxy)<br>gui.<span class="hljs-title function_">add</span>(parameters, <span class="hljs-string">&#x27;randomnessPower&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>).<span class="hljs-title function_">onFinishChange</span>(generateGalaxy)<br>gui.<span class="hljs-title function_">addColor</span>(parameters, <span class="hljs-string">&#x27;insideColor&#x27;</span>).<span class="hljs-title function_">onFinishChange</span>(generateGalaxy)<br>gui.<span class="hljs-title function_">addColor</span>(parameters, <span class="hljs-string">&#x27;outsideColor&#x27;</span>).<span class="hljs-title function_">onFinishChange</span>(generateGalaxy)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建几何体</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// const cube = new THREE.Mesh(</span><br><span class="hljs-comment">//   new THREE.BoxGeometry(),</span><br><span class="hljs-comment">//   new THREE.MeshBasicMaterial()</span><br><span class="hljs-comment">// )</span><br><span class="hljs-comment">// scene.add(cube)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 坐标轴 缩放倍率</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>axesHelper.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.01</span><br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视口宽高</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建相机 视野角度 宽高比例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">100</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 相机坐标</span><br><span class="hljs-comment"> */</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">3</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加</span><br><span class="hljs-comment"> */</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 循环每一帧</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> elapsedTime = clock.<span class="hljs-title function_">getElapsedTime</span>()<br><br>  points.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = elapsedTime * <span class="hljs-number">0.01</span><br>  points.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = elapsedTime * <span class="hljs-number">0.1</span><br><br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br><br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br><br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>粒子</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>16.粒子，简易海浪波动</title>
    <link href="/2022/09/16/threejs/16-%E7%B2%92%E5%AD%90%EF%BC%8C%E7%AE%80%E6%98%93%E6%B5%B7%E6%B5%AA%E6%B3%A2%E5%8A%A8/"/>
    <url>/2022/09/16/threejs/16-%E7%B2%92%E5%AD%90%EF%BC%8C%E7%AE%80%E6%98%93%E6%B5%B7%E6%B5%AA%E6%B3%A2%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入three.js</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">// 调试组件</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dat.gui&#x27;</span><br><br><span class="hljs-comment">// 创建调试组件</span><br><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> dat.<span class="hljs-title function_">GUI</span>()<br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 加载纹理</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>()<br><span class="hljs-keyword">const</span> particleTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/particles/2.png&#x27;</span>))<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建画布</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">/** </span><br><span class="hljs-comment"> *粒子</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> particlesGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferGeometry</span>()<br><span class="hljs-keyword">const</span> count = <span class="hljs-number">20000</span><br><br><span class="hljs-keyword">const</span> position = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(count * <span class="hljs-number">3</span>)<br><span class="hljs-keyword">const</span> colors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(count * <span class="hljs-number">3</span>)<br><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count * <span class="hljs-number">3</span>; i++) &#123;<br>  position[i] = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">10</span><br>  colors[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()<br>&#125;<br><br>particlesGeometry.<span class="hljs-title function_">setAttribute</span>(<br>  <span class="hljs-string">&#x27;position&#x27;</span>,<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(position, <span class="hljs-number">3</span>)<br>)<br>particlesGeometry.<span class="hljs-title function_">setAttribute</span>( <span class="hljs-comment">// 开启混合颜色</span><br>  <span class="hljs-string">&#x27;color&#x27;</span>,<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(colors, <span class="hljs-number">3</span>)<br>)<br><br><span class="hljs-keyword">const</span> particlesMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointsMaterial</span>(&#123; <span class="hljs-comment">// 点材质</span><br>  <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#ff88cc&#x27;</span>,<br>  <span class="hljs-attr">size</span>: <span class="hljs-number">0.1</span>, <span class="hljs-comment">// 设置点的大小。默认值为1.0。</span><br>  <span class="hljs-attr">sizeAttenuation</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 指定点的大小是否因相机深度而衰减。（仅限透视摄像头。）默认为true。</span><br>  <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">alphaMap</span>: particleTexture,<br>  <span class="hljs-comment">// alphaTest: 0.001, // 可以解决粒子贴图黑边的问题</span><br>  <span class="hljs-comment">// depthTest: false, // 距离遮挡，关闭可以透视 可以解决粒子贴图黑边的问题</span><br>  <span class="hljs-attr">depthWrite</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 可以解决粒子贴图黑边的问题</span><br>  <span class="hljs-attr">blending</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">AdditiveBlending</span>, <span class="hljs-comment">// 颜色混合 以靠近白色为标准 消耗性能</span><br>  <span class="hljs-attr">vertexColors</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启混合颜色</span><br>&#125;)<br><br><span class="hljs-keyword">const</span> particles  = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Points</span>( <span class="hljs-comment">// 点 粒子</span><br>  particlesGeometry,<br>  particlesMaterial<br>)<br>scene.<span class="hljs-title function_">add</span>(particles)<br><br><span class="hljs-comment">// const cube = new THREE.Mesh(</span><br><span class="hljs-comment">//   new THREE.BoxGeometry(),</span><br><span class="hljs-comment">//   new THREE.MeshBasicMaterial()</span><br><span class="hljs-comment">// )</span><br><span class="hljs-comment">// scene.add(cube)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 坐标轴 缩放倍率</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>axesHelper.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.01</span><br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视口宽高</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建相机 视野角度 宽高比例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">100</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 相机坐标</span><br><span class="hljs-comment"> */</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加</span><br><span class="hljs-comment"> */</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 循环每一帧</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> elapsedTime = clock.<span class="hljs-title function_">getElapsedTime</span>()<br><br>  <span class="hljs-comment">// particles.rotation.y = elapsedTime * 0.2</span><br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>    <span class="hljs-keyword">const</span> i3 = i * <span class="hljs-number">3</span><br>    <span class="hljs-keyword">const</span> x = particlesGeometry.<span class="hljs-property">attributes</span>.<span class="hljs-property">position</span>.<span class="hljs-property">array</span>[i3]<br>    particlesGeometry.<span class="hljs-property">attributes</span>.<span class="hljs-property">position</span>.<span class="hljs-property">array</span>[i3 + <span class="hljs-number">1</span>] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime + x)<br>  &#125;<br><br>  particlesGeometry.<span class="hljs-property">attributes</span>.<span class="hljs-property">position</span>.<span class="hljs-property">needsUpdate</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 更新渲染位置</span><br><br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br><br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br><br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>粒子</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>15.简易闹鬼房屋，墙壁，草地，鬼魂，雾</title>
    <link href="/2022/09/15/threejs/15-%E7%AE%80%E6%98%93%E9%97%B9%E9%AC%BC%E6%88%BF%E5%B1%8B%EF%BC%8C%E5%A2%99%E5%A3%81%EF%BC%8C%E8%8D%89%E5%9C%B0%EF%BC%8C%E9%AC%BC%E9%AD%82%EF%BC%8C%E9%9B%BE/"/>
    <url>/2022/09/15/threejs/15-%E7%AE%80%E6%98%93%E9%97%B9%E9%AC%BC%E6%88%BF%E5%B1%8B%EF%BC%8C%E5%A2%99%E5%A3%81%EF%BC%8C%E8%8D%89%E5%9C%B0%EF%BC%8C%E9%AC%BC%E9%AD%82%EF%BC%8C%E9%9B%BE/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入three.js</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入 矩形区域灯光辅助对象</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RectAreaLightHelper</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/helpers/RectAreaLightHelper.js&#x27;</span><br><span class="hljs-comment">// 调试组件</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dat.gui&#x27;</span><br><br><span class="hljs-comment">// 创建调试组件</span><br><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> dat.<span class="hljs-title function_">GUI</span>()<br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 加载纹理</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>()<br><span class="hljs-keyword">const</span> doorColorTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/color.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorAlphaTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/alpha.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorAmbientOccTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/ambientOcclusion.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorHeightTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/height.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorNormalTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/normal.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorMetalnessTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/metalness.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorRoughnessTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/roughness.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> matcapTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/matcaps/1.png&#x27;</span>))<br><span class="hljs-keyword">const</span> gradientTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/gradients/3.jpg&#x27;</span>))<br><br><span class="hljs-keyword">const</span> bricksColorTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/bricks/color.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> bricksAmbientOcclusionTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/bricks/ambientOcclusion.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> bricksNormalTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/bricks/normal.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> bricksRoughnessTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/bricks/roughness.jpg&#x27;</span>))<br><br><span class="hljs-keyword">const</span> grassColorTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/grass/color.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> grassAmbientOcclusionTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/grass/ambientOcclusion.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> grassNormalTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/grass/normal.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> grassRoughnessTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/grass/roughness.jpg&#x27;</span>))<br><br><span class="hljs-comment">// 设置材质宽高</span><br>grassColorTexture.<span class="hljs-property">repeat</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>)<br>grassAmbientOcclusionTexture.<span class="hljs-property">repeat</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>)<br>grassNormalTexture.<span class="hljs-property">repeat</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>)<br>grassRoughnessTexture.<span class="hljs-property">repeat</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>)<br><span class="hljs-comment">// 设置材质平铺 默认拉伸最后一个像素</span><br>grassColorTexture.<span class="hljs-property">wrapS</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span><br>grassAmbientOcclusionTexture.<span class="hljs-property">wrapS</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span><br>grassNormalTexture.<span class="hljs-property">wrapS</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span><br>grassRoughnessTexture.<span class="hljs-property">wrapS</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span><br><span class="hljs-comment">// 设置材质平铺 默认拉伸最后一个像素</span><br>grassColorTexture.<span class="hljs-property">wrapT</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span><br>grassAmbientOcclusionTexture.<span class="hljs-property">wrapT</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span><br>grassNormalTexture.<span class="hljs-property">wrapT</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span><br>grassRoughnessTexture.<span class="hljs-property">wrapT</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建画布</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建雾</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> fog = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Fog</span>(<span class="hljs-string">&#x27;#262837&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">15</span>) <span class="hljs-comment">// 颜色 最小距离 最大距离</span><br>scene.<span class="hljs-property">fog</span> = fog<br><br><span class="hljs-comment">// 创建模型</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 房子</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> house = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()<br>scene.<span class="hljs-title function_">add</span>(house)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 墙壁</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> walls = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">4</span>, <span class="hljs-number">2.5</span>, <span class="hljs-number">4</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>    <span class="hljs-attr">map</span>: bricksColorTexture, <span class="hljs-comment">// 颜色贴图</span><br>    <span class="hljs-attr">aoMap</span>: bricksAmbientOcclusionTexture, <span class="hljs-comment">// ao贴图</span><br>    <span class="hljs-attr">normalMap</span>: bricksNormalTexture, <span class="hljs-comment">// 法线贴图</span><br>    <span class="hljs-attr">roughnessMap</span>: bricksRoughnessTexture, <span class="hljs-comment">// 粗糙度贴图</span><br>    <span class="hljs-comment">// displacementMap: bricksAmbientOcclusionTexture,</span><br>    <span class="hljs-comment">// wireframe: true</span><br>  &#125;)<br>)<br>walls.<span class="hljs-property">geometry</span>.<span class="hljs-title function_">setAttribute</span>(<br>  <span class="hljs-string">&#x27;uv2&#x27;</span>,<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Float32BufferAttribute</span>(walls.<span class="hljs-property">geometry</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">uv</span>.<span class="hljs-property">array</span>, <span class="hljs-number">2</span>)<br>)<br>walls.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1.25</span><br>house.<span class="hljs-title function_">add</span>(walls)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 屋顶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> roof = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ConeGeometry</span>(<span class="hljs-number">3.5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#b35f45&#x27;</span> &#125;)<br>)<br>roof.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2.5</span> + <span class="hljs-number">0.5</span><br>roof.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span><br>house.<span class="hljs-title function_">add</span>(roof)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 门</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> door = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">2.2</span>, <span class="hljs-number">2.2</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>    <span class="hljs-attr">map</span>: doorColorTexture,<br>    <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">alphaMap</span>: doorAlphaTexture,<br>    <span class="hljs-attr">aoMap</span>: doorAmbientOccTexture,<br>    <span class="hljs-attr">displacementMap</span>: doorHeightTexture,<br>    <span class="hljs-attr">displacementScale</span>: <span class="hljs-number">0.1</span>,<br>    <span class="hljs-attr">normalMap</span>: doorNormalTexture,<br>    <span class="hljs-attr">metalnessMap</span>: doorMetalnessTexture,<br>    <span class="hljs-attr">roughnessMap</span>: doorRoughnessTexture,<br>  &#125;)<br>)<br>door.<span class="hljs-property">geometry</span>.<span class="hljs-title function_">setAttribute</span>(<br>  <span class="hljs-string">&#x27;uv2&#x27;</span>,<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Float32BufferAttribute</span>(door.<span class="hljs-property">geometry</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">uv</span>.<span class="hljs-property">array</span>, <span class="hljs-number">2</span>)<br>)<br>door.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>door.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">2</span> + <span class="hljs-number">0.01</span><br>house.<span class="hljs-title function_">add</span>(door)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 灌木丛</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> bushGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SphereGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>)<br><span class="hljs-keyword">const</span> bushMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#89c854&#x27;</span> &#125;)<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>  <span class="hljs-keyword">const</span> bush = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>    bushGeometry,<br>    bushMaterial<br>  )<br>  <span class="hljs-keyword">const</span> angle = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span><br>  <span class="hljs-keyword">const</span> radius = <span class="hljs-number">3</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()<br>  <span class="hljs-keyword">const</span> x = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle) * radius<br>  <span class="hljs-keyword">const</span> z = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle) * radius<br>  <span class="hljs-keyword">const</span> scale = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(), <span class="hljs-number">0.2</span>)<br>  bush.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(x, <span class="hljs-number">0.1</span>, z)<br>  bush.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(scale, scale, scale)<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 如果是循环随机散布，则需要单独 开启阴影</span><br><span class="hljs-comment">   */</span><br>  bush.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br>  house.<span class="hljs-title function_">add</span>(bush)<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 地板 草地</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> floor = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( <span class="hljs-comment">// 地板 宽，高</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123;<br>    <span class="hljs-attr">map</span>: grassColorTexture,<br>    <span class="hljs-attr">aoMap</span>: grassAmbientOcclusionTexture,<br>    <span class="hljs-attr">normalMap</span>: grassNormalTexture,<br>    <span class="hljs-attr">roughnessMap</span>: grassRoughnessTexture<br>  &#125;)<br>)<br>floor.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = - <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span><br>floor.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br>scene.<span class="hljs-title function_">add</span>(floor)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 坟墓</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> graves = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()<br>scene.<span class="hljs-title function_">add</span>(graves)<br><br><span class="hljs-keyword">const</span> graveGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">0.6</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.2</span>)<br><span class="hljs-keyword">const</span> graveMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#b2b6b1&#x27;</span> &#125;)<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) &#123;<br>  <span class="hljs-keyword">const</span> grave = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>    graveGeometry,<br>    graveMaterial<br>  )<br>  <span class="hljs-keyword">const</span> angle = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span><br>  <span class="hljs-keyword">const</span> radius = <span class="hljs-number">3</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">6</span><br>  <span class="hljs-keyword">const</span> x = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle) * radius<br>  <span class="hljs-keyword">const</span> z = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle) * radius<br>  grave.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(x, <span class="hljs-number">0.3</span>, z)<br>  grave.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">0.4</span><br>  grave.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br><br>  graves.<span class="hljs-title function_">add</span>(grave)<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 只是模拟真实光照 没有光追无法实现模拟真实光照!!!浏览器单核没这个性能</span><br><span class="hljs-comment"> * 环境光 配合 平行光 使用</span><br><span class="hljs-comment"> * 注意 光源没有实体 只能使用辅助方法显示位置 如果要做灯泡效果只需要光源位置一样</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xb9d5ff</span>, <span class="hljs-number">0.12</span>) <span class="hljs-comment">// 环境光 全覆盖 底光？暗光？</span><br>scene.<span class="hljs-title function_">add</span>(ambientLight)<br>gui.<span class="hljs-title function_">add</span>(ambientLight, <span class="hljs-string">&#x27;intensity&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br><br><span class="hljs-keyword">const</span> moonLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xb9d5ff</span>, <span class="hljs-number">0.12</span>) <span class="hljs-comment">// 平行光 全覆盖 从高度斜射</span><br>moonLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, - <span class="hljs-number">1</span>)<br>gui.<span class="hljs-title function_">add</span>(moonLight, <span class="hljs-string">&#x27;intensity&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>gui.<span class="hljs-title function_">add</span>(moonLight.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;x&#x27;</span>).<span class="hljs-title function_">min</span>(- <span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>gui.<span class="hljs-title function_">add</span>(moonLight.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;y&#x27;</span>).<span class="hljs-title function_">min</span>(- <span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>gui.<span class="hljs-title function_">add</span>(moonLight.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;z&#x27;</span>).<span class="hljs-title function_">min</span>(- <span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>scene.<span class="hljs-title function_">add</span>(moonLight)<br><br><span class="hljs-keyword">const</span> doorLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-string">&#x27;#ff7d46&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>) <span class="hljs-comment">// 点光源</span><br>doorLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2.2</span>, <span class="hljs-number">2.7</span>)<br>house.<span class="hljs-title function_">add</span>(doorLight)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 鬼魂</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> ghost1 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-string">&#x27;#ff00ff&#x27;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-comment">// 点光源</span><br>scene.<span class="hljs-title function_">add</span>(ghost1)<br><span class="hljs-keyword">const</span> ghost2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-string">&#x27;#00ffff&#x27;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-comment">// 点光源</span><br>scene.<span class="hljs-title function_">add</span>(ghost2)<br><span class="hljs-keyword">const</span> ghost3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-string">&#x27;#ffff00&#x27;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-comment">// 点光源</span><br>scene.<span class="hljs-title function_">add</span>(ghost3)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 坐标轴 缩放倍率</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>axesHelper.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.01</span><br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视口宽高</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建相机 视野角度 宽高比例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">100</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 相机坐标</span><br><span class="hljs-comment"> */</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">3</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">3</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">8</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加</span><br><span class="hljs-comment"> */</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 循环每一帧</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> elapsedTime = clock.<span class="hljs-title function_">getElapsedTime</span>()<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 鬼魂动画 鬼魂动作</span><br><span class="hljs-comment">   * x z 轴配合做圆周运动</span><br><span class="hljs-comment">   * y轴任意组合实现不同出现离开效果</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">const</span> ghost1Angle = elapsedTime * <span class="hljs-number">0.5</span><br>  ghost1.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(ghost1Angle) * <span class="hljs-number">4</span><br>  ghost1.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(ghost1Angle) * <span class="hljs-number">4</span><br>  ghost1.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(ghost1Angle * <span class="hljs-number">3</span>)<br><br>  <span class="hljs-keyword">const</span> ghost2Angle = - elapsedTime * <span class="hljs-number">0.32</span><br>  ghost2.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(ghost2Angle) * <span class="hljs-number">5</span><br>  ghost2.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(ghost2Angle) * <span class="hljs-number">5</span><br>  ghost2.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(ghost2Angle * <span class="hljs-number">4</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime * <span class="hljs-number">2.5</span>)<br><br>  <span class="hljs-keyword">const</span> ghost3Angle = elapsedTime * <span class="hljs-number">0.18</span><br>  ghost3.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(ghost3Angle) * (<span class="hljs-number">7</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime * <span class="hljs-number">0.32</span>))<br>  ghost3.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(ghost3Angle) * (<span class="hljs-number">7</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime * <span class="hljs-number">0.5</span>))<br>  ghost3.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime * <span class="hljs-number">4</span>) * (<span class="hljs-number">7</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime * <span class="hljs-number">2.5</span>))<br><br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br><br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br><br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 开启实时渲染阴影 开启阴影</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 统一开启需要的阴影</span><br><span class="hljs-comment">   */</span><br>  moonLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br>  doorLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br>  ghost1.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br>  ghost2.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br>  ghost3.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br><br>  walls.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 通常 草地 地板开启接受阴影</span><br><span class="hljs-comment">   */</span><br>  floor.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 性能优化 像案例中 门这种基本不投影的 降低阴影质量</span><br><span class="hljs-comment">   */</span><br>  doorLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">width</span> = <span class="hljs-number">1024</span> / <span class="hljs-number">4</span><br>  doorLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">height</span> = <span class="hljs-number">1024</span> / <span class="hljs-number">4</span><br>  doorLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">7</span><br><br>  ghost1.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">width</span> = <span class="hljs-number">1024</span> / <span class="hljs-number">4</span><br>  ghost1.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">height</span> = <span class="hljs-number">1024</span> / <span class="hljs-number">4</span><br>  ghost1.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">7</span><br>  ghost2.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">width</span> = <span class="hljs-number">1024</span> / <span class="hljs-number">4</span><br>  ghost2.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">height</span> = <span class="hljs-number">1024</span> / <span class="hljs-number">4</span><br>  ghost2.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">7</span><br>  ghost3.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">width</span> = <span class="hljs-number">1024</span> / <span class="hljs-number">4</span><br>  ghost3.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-property">height</span> = <span class="hljs-number">1024</span> / <span class="hljs-number">4</span><br>  ghost3.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">7</span><br><br>  <span class="hljs-comment">// 设置背景雾色</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setClearColor</span>(<span class="hljs-string">&#x27;#262837&#x27;</span>)<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
      <tag>贴图</tag>
      
      <tag>Ao</tag>
      
      <tag>房屋</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>14.烘焙阴影，烘焙阴影跟随移动</title>
    <link href="/2022/09/14/threejs/14-%E7%83%98%E7%84%99%E9%98%B4%E5%BD%B1%EF%BC%8C%E7%83%98%E7%84%99%E9%98%B4%E5%BD%B1%E8%B7%9F%E9%9A%8F%E7%A7%BB%E5%8A%A8/"/>
    <url>/2022/09/14/threejs/14-%E7%83%98%E7%84%99%E9%98%B4%E5%BD%B1%EF%BC%8C%E7%83%98%E7%84%99%E9%98%B4%E5%BD%B1%E8%B7%9F%E9%9A%8F%E7%A7%BB%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入three.js</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入 矩形区域灯光辅助对象</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RectAreaLightHelper</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/helpers/RectAreaLightHelper.js&#x27;</span><br><span class="hljs-comment">// 调试组件</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dat.gui&#x27;</span><br><br><span class="hljs-comment">// 创建调试组件</span><br><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> dat.<span class="hljs-title function_">GUI</span>()<br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 加载纹理</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>()<br><span class="hljs-keyword">const</span> bakedShadow = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/shadow/bakedShadow.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> simpleShadow = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/shadow/simpleShadow.jpg&#x27;</span>))<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建画布</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建材质</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>()<br>material.<span class="hljs-property">roughness</span> = <span class="hljs-number">0.7</span><br>gui.<span class="hljs-title function_">add</span>(material, <span class="hljs-string">&#x27;metalness&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;金属度&#x27;</span>)<br>gui.<span class="hljs-title function_">add</span>(material, <span class="hljs-string">&#x27;roughness&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;粗糙度&#x27;</span>)<br><span class="hljs-comment">// material.wireframe = true // 网格线 查看面数</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建模型</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sphere = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SphereGeometry</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>),<br>  material<br>)<br><br><span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( <span class="hljs-comment">// 地板 宽，高</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-comment">// 基本材质 平行烘焙阴影</span><br>    <span class="hljs-attr">map</span>: bakedShadow <span class="hljs-comment">// 直接就是一张贴图</span><br>  &#125;)<br>)<br>cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = - <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span><br>cube.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = -<span class="hljs-number">0.65</span><br><br>scene.<span class="hljs-title function_">add</span>(sphere, cube)<br><br><span class="hljs-keyword">const</span> sphereShadow = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">1.5</span>, <span class="hljs-number">1.5</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-comment">// 基本材质 垂直烘焙阴影</span><br>    <span class="hljs-attr">color</span>: <span class="hljs-number">0x000000</span>, <span class="hljs-comment">// 阴影颜色</span><br>    <span class="hljs-attr">alphaMap</span>: simpleShadow, <span class="hljs-comment">// 阴影渐变范围 类似PS蒙版</span><br>    <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 打开渐变</span><br>  &#125;)<br>)<br>sphereShadow.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = - <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">0.5</span><br>sphereShadow.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = cube.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> + <span class="hljs-number">0.01</span><br>scene.<span class="hljs-title function_">add</span>(sphereShadow)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 只是模拟真实光照 没有光追无法实现模拟真实光照!!!浏览器单核没这个性能</span><br><span class="hljs-comment"> * 环境光 配合 平行光 使用</span><br><span class="hljs-comment"> * 注意 光源没有实体 只能使用辅助方法显示位置 如果要做灯泡效果只需要光源位置一样</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.3</span>) <span class="hljs-comment">// 环境光 全覆盖 底光？暗光？</span><br>scene.<span class="hljs-title function_">add</span>(ambientLight)<br>gui.<span class="hljs-title function_">add</span>(ambientLight, <span class="hljs-string">&#x27;intensity&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br><br><span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.3</span>) <span class="hljs-comment">// 平行光 全覆盖 从高度斜射</span><br>directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, - <span class="hljs-number">1</span>)<br>gui.<span class="hljs-title function_">add</span>(directionalLight, <span class="hljs-string">&#x27;intensity&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>gui.<span class="hljs-title function_">add</span>(directionalLight.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;x&#x27;</span>).<span class="hljs-title function_">min</span>(- <span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>gui.<span class="hljs-title function_">add</span>(directionalLight.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;y&#x27;</span>).<span class="hljs-title function_">min</span>(- <span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>gui.<span class="hljs-title function_">add</span>(directionalLight.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;z&#x27;</span>).<span class="hljs-title function_">min</span>(- <span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">top</span> = <span class="hljs-number">3</span> <span class="hljs-comment">// 阴影计算范围 长宽高 摄像机视锥体上侧面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">right</span> = <span class="hljs-number">3</span> <span class="hljs-comment">// 阴影计算范围 长宽高 摄像机视锥体右侧面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">bottom</span> = -<span class="hljs-number">3</span> <span class="hljs-comment">// 阴影计算范围 长宽高 摄像机视锥体下侧面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">left</span> = -<span class="hljs-number">3</span> <span class="hljs-comment">// 阴影计算范围 长宽高 摄像机视锥体左侧面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">near</span> = <span class="hljs-number">1</span> <span class="hljs-comment">// 摄像机视锥体近端面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">6</span> <span class="hljs-comment">// 阴影计算范围 延伸 摄像机视锥体远端面</span><br>scene.<span class="hljs-title function_">add</span>(directionalLight)<br><br><span class="hljs-keyword">const</span> spotLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SpotLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.4</span>, <span class="hljs-number">10</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">0.3</span>)  <span class="hljs-comment">// 聚光灯</span><br>spotLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">fov</span> = <span class="hljs-number">30</span><br>spotLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">near</span> = <span class="hljs-number">1</span><br>spotLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">6</span><br>spotLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br>scene.<span class="hljs-title function_">add</span>(spotLight)<br><br><span class="hljs-keyword">const</span> pointLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.3</span>) <span class="hljs-comment">// 点光源</span><br>pointLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">near</span> = <span class="hljs-number">0.1</span><br>pointLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">5</span><br>pointLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>)<br>scene.<span class="hljs-title function_">add</span>(pointLight)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 坐标轴 缩放倍率</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视口宽高</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建相机 视野角度 宽高比例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">100</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 相机坐标</span><br><span class="hljs-comment"> */</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">2</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加</span><br><span class="hljs-comment"> */</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>()<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> elapsedTime = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 球体移动</span><br><span class="hljs-comment">   */</span><br>  sphere.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(elapsedTime) * <span class="hljs-number">1.5</span><br>  sphere.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime) * <span class="hljs-number">1.5</span><br>  sphere.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime * <span class="hljs-number">3</span>))<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 垂直烘焙阴影移动</span><br><span class="hljs-comment">   */</span><br>  sphereShadow.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(elapsedTime) * <span class="hljs-number">1.5</span><br>  sphereShadow.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime) * <span class="hljs-number">1.5</span><br>  <span class="hljs-comment">// sphereShadow.scale.set(Math.abs(Math.cos(elapsedTime * 3)), Math.abs(Math.cos(elapsedTime * 3)), Math.abs(Math.cos(elapsedTime * 3)))</span><br>  sphereShadow.<span class="hljs-property">material</span>.<span class="hljs-property">opacity</span> = (<span class="hljs-number">1</span> - sphere.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>) * <span class="hljs-number">0.3</span><br><br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br><br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br><br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
      <tag>烘焙阴影</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>13.渲染阴影</title>
    <link href="/2022/09/13/threejs/13-%E6%B8%B2%E6%9F%93%E9%98%B4%E5%BD%B1/"/>
    <url>/2022/09/13/threejs/13-%E6%B8%B2%E6%9F%93%E9%98%B4%E5%BD%B1/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入three.js</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入 矩形区域灯光辅助对象</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RectAreaLightHelper</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/helpers/RectAreaLightHelper.js&#x27;</span><br><span class="hljs-comment">// 调试组件</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dat.gui&#x27;</span><br><br><span class="hljs-comment">// 创建调试组件</span><br><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> dat.<span class="hljs-title function_">GUI</span>()<br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建画布</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建材质</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>()<br>material.<span class="hljs-property">roughness</span> = <span class="hljs-number">0.7</span><br>gui.<span class="hljs-title function_">add</span>(material, <span class="hljs-string">&#x27;metalness&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;金属度&#x27;</span>)<br>gui.<span class="hljs-title function_">add</span>(material, <span class="hljs-string">&#x27;roughness&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;粗糙度&#x27;</span>)<br><span class="hljs-comment">// material.wireframe = true // 网格线 查看面数</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建模型</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sphere = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SphereGeometry</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>),<br>  material<br>)<br>sphere.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">1.5</span><br>sphere.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 打开阴影投射</span><br><span class="hljs-keyword">const</span> plane = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( <span class="hljs-comment">// 宽，高</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  material<br>)<br>plane.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 打开阴影投射</span><br><span class="hljs-keyword">const</span> torus = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TorusGeometry</span>(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">16</span>, <span class="hljs-number">32</span>),<br>  material<br>)<br>torus.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1.5</span><br>torus.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 打开阴影投射</span><br><span class="hljs-keyword">const</span> box = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  material<br>)<br>box.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">3</span><br>box.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 打开阴影投射</span><br><br><span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( <span class="hljs-comment">// 地板 宽，高</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>),<br>  material<br>)<br>cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = - <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span><br>cube.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = -<span class="hljs-number">0.65</span><br>cube.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 打开阴影接收</span><br><span class="hljs-comment">// const cube2 = new THREE.Mesh( // 地板 宽，高</span><br><span class="hljs-comment">//   new THREE.PlaneGeometry(10, 10),</span><br><span class="hljs-comment">//   material</span><br><span class="hljs-comment">// )</span><br><span class="hljs-comment">// cube2.rotation.x = Math.PI / 2</span><br><span class="hljs-comment">// cube2.position.y = 0.65</span><br><br>scene.<span class="hljs-title function_">add</span>(sphere, plane, torus, box, cube)<br><span class="hljs-comment">// scene.add(sphere, plane, torus, box, cube, cube2)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 只是模拟真实光照 没有光追无法实现模拟真实光照!!!浏览器单核没这个性能</span><br><span class="hljs-comment"> * 环境光 配合 平行光 使用</span><br><span class="hljs-comment"> * 注意 光源没有实体 只能使用辅助方法显示位置 如果要做灯泡效果只需要光源位置一样</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.3</span>) <span class="hljs-comment">// 环境光 全覆盖 底光？暗光？</span><br>scene.<span class="hljs-title function_">add</span>(ambientLight)<br>gui.<span class="hljs-title function_">add</span>(ambientLight, <span class="hljs-string">&#x27;intensity&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br><br><span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.3</span>) <span class="hljs-comment">// 平行光 全覆盖 从高度斜射</span><br>directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, - <span class="hljs-number">1</span>)<br>gui.<span class="hljs-title function_">add</span>(directionalLight, <span class="hljs-string">&#x27;intensity&#x27;</span>).<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>gui.<span class="hljs-title function_">add</span>(directionalLight.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;x&#x27;</span>).<span class="hljs-title function_">min</span>(- <span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>gui.<span class="hljs-title function_">add</span>(directionalLight.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;y&#x27;</span>).<span class="hljs-title function_">min</span>(- <span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>gui.<span class="hljs-title function_">add</span>(directionalLight.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;z&#x27;</span>).<span class="hljs-title function_">min</span>(- <span class="hljs-number">5</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">step</span>(<span class="hljs-number">0.001</span>)<br>directionalLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 打开平行光 阴影</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>) <span class="hljs-comment">// 阴影贴图质量 阴影分辨率 1024 2048 4096 类似于文明6游戏设置</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">top</span> = <span class="hljs-number">3</span> <span class="hljs-comment">// 阴影计算范围 长宽高 摄像机视锥体上侧面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">right</span> = <span class="hljs-number">3</span> <span class="hljs-comment">// 阴影计算范围 长宽高 摄像机视锥体右侧面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">bottom</span> = -<span class="hljs-number">3</span> <span class="hljs-comment">// 阴影计算范围 长宽高 摄像机视锥体下侧面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">left</span> = -<span class="hljs-number">3</span> <span class="hljs-comment">// 阴影计算范围 长宽高 摄像机视锥体左侧面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">near</span> = <span class="hljs-number">1</span> <span class="hljs-comment">// 摄像机视锥体近端面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">6</span> <span class="hljs-comment">// 阴影计算范围 延伸 摄像机视锥体远端面</span><br>directionalLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">radius</span> = <span class="hljs-number">10</span> <span class="hljs-comment">// 阴影模糊 与 PCF 阴影 不兼容</span><br>scene.<span class="hljs-title function_">add</span>(directionalLight)<br><br><span class="hljs-comment">// const directionalLightHelper = new THREE.CameraHelper(directionalLight.shadow.camera) // 平行光阴影范围UI</span><br><span class="hljs-comment">// scene.add(directionalLightHelper)</span><br><br><br><span class="hljs-keyword">const</span> spotLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SpotLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.4</span>, <span class="hljs-number">10</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">0.3</span>)  <span class="hljs-comment">// 聚光灯</span><br>spotLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br>spotLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>) <span class="hljs-comment">// 阴影贴图质量 阴影分辨率 1024 2048 4096 类似于文明6游戏设置</span><br>spotLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">fov</span> = <span class="hljs-number">30</span><br>spotLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">near</span> = <span class="hljs-number">1</span><br>spotLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">6</span><br>spotLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br>scene.<span class="hljs-title function_">add</span>(spotLight)<br><br><span class="hljs-comment">// const spotLightCameraHelper = new THREE.CameraHelper(spotLight.shadow.camera)  // 聚光灯阴影范围UI</span><br><span class="hljs-comment">// scene.add(spotLightCameraHelper)</span><br><br><span class="hljs-keyword">const</span> pointLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.3</span>) <span class="hljs-comment">// 点光源</span><br>pointLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span><br>pointLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">mapSize</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">4</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>) <span class="hljs-comment">// 阴影贴图质量 阴影分辨率 1024 2048 4096 类似于文明6游戏设置</span><br>pointLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">near</span> = <span class="hljs-number">0.1</span><br>pointLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">far</span> = <span class="hljs-number">5</span><br>pointLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>)<br>scene.<span class="hljs-title function_">add</span>(pointLight)<br><br><span class="hljs-keyword">const</span> pointLightHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">CameraHelper</span>(pointLight.<span class="hljs-property">shadow</span>.<span class="hljs-property">camera</span>)<br>scene.<span class="hljs-title function_">add</span>(pointLightHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 坐标轴 缩放倍率</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视口宽高</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建相机 视野角度 宽高比例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">100</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 相机坐标</span><br><span class="hljs-comment"> */</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">2</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加</span><br><span class="hljs-comment"> */</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>()<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-comment">// y轴原地旋转</span><br>  <span class="hljs-keyword">const</span> elapsedTime = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>  sphere.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.1</span> * elapsedTime<br>  plane.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.1</span> * elapsedTime<br>  torus.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.1</span> * elapsedTime<br>  box.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.1</span> * elapsedTime<br>  <span class="hljs-comment">// x轴原地旋转</span><br>  sphere.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.15</span> * elapsedTime<br>  plane.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.15</span> * elapsedTime<br>  torus.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.15</span> * elapsedTime<br>  box.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.15</span> * elapsedTime<br><br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br><br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br><br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 允许投射阴影 打开阴影</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span><br>  <span class="hljs-comment">// renderer.value.shadowMap.type = THREE.PCFSoftShadowMap // PCF 阴影，适合低分辨率 与 shadow.radius 阴影模糊 不兼容</span><br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
      <tag>实时渲染阴影</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>12.光线，色彩，辅助</title>
    <link href="/2022/09/12/threejs/12-%E5%85%89%E7%BA%BF%EF%BC%8C%E8%89%B2%E5%BD%A9%EF%BC%8C%E8%BE%85%E5%8A%A9/"/>
    <url>/2022/09/12/threejs/12-%E5%85%89%E7%BA%BF%EF%BC%8C%E8%89%B2%E5%BD%A9%EF%BC%8C%E8%BE%85%E5%8A%A9/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入three.js</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入 矩形区域灯光辅助对象</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">RectAreaLightHelper</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/helpers/RectAreaLightHelper.js&#x27;</span><br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建画布</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建材质</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>()<br>material.<span class="hljs-property">roughness</span> = <span class="hljs-number">0.4</span><br><span class="hljs-comment">// material.wireframe = true // 网格线 查看面数</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建模型</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sphere = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SphereGeometry</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>),<br>  material<br>)<br>sphere.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">1.5</span><br><span class="hljs-keyword">const</span> plane = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( <span class="hljs-comment">// 宽，高</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  material<br>)<br><span class="hljs-keyword">const</span> torus = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TorusGeometry</span>(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">16</span>, <span class="hljs-number">32</span>),<br>  material<br>)<br>torus.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1.5</span><br><span class="hljs-keyword">const</span> box = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  material<br>)<br>box.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">3</span><br><br><span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( <span class="hljs-comment">// 地板 宽，高</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>),<br>  material<br>)<br>cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = - <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span><br>cube.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = -<span class="hljs-number">0.65</span><br><span class="hljs-keyword">const</span> cube2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( <span class="hljs-comment">// 地板 宽，高</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>),<br>  material<br>)<br>cube2.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span><br>cube2.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.65</span><br><br>scene.<span class="hljs-title function_">add</span>(sphere, plane, torus, box, cube, cube2)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 只是模拟真实光照 没有光追无法实现模拟真实光照!!!浏览器单核没这个性能</span><br><span class="hljs-comment"> * 环境光 配合 平行光 使用</span><br><span class="hljs-comment"> * 注意 光源没有实体 只能使用辅助方法显示位置 如果要做灯泡效果只需要光源位置一样</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.5</span>) <span class="hljs-comment">// 环境光 全覆盖 底光？暗光？</span><br>scene.<span class="hljs-title function_">add</span>(ambientLight)<br><br><span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0x00fffc</span>, <span class="hljs-number">0.3</span>) <span class="hljs-comment">// 平行光 从高度斜射</span><br>directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0.25</span>, <span class="hljs-number">0</span>)<br>scene.<span class="hljs-title function_">add</span>(directionalLight)<br><br><span class="hljs-keyword">const</span> hemisphereLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">HemisphereLight</span>(<span class="hljs-number">0xff0000</span>, <span class="hljs-number">0x0000ff</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// 渐变光 单面手电筒效应 PS渐变</span><br>scene.<span class="hljs-title function_">add</span>(hemisphereLight)<br><br><span class="hljs-keyword">const</span> pointLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-number">0xff9000</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>) <span class="hljs-comment">// 点光源 颜色 强度 距离 衰减</span><br>pointLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1</span>, -<span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>)<br>scene.<span class="hljs-title function_">add</span>(pointLight)<br><br><span class="hljs-keyword">const</span> rectAreaLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">RectAreaLight</span>(<span class="hljs-number">0x4e00ff</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// 平面光光源，角落光 颜色 强度 宽 高</span><br>rectAreaLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">1.5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1.5</span>)<br>rectAreaLight.<span class="hljs-title function_">lookAt</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector3</span>()) <span class="hljs-comment">// 光源指向中心坐标点 0, 0, 0</span><br>scene.<span class="hljs-title function_">add</span>(rectAreaLight)<br><br><span class="hljs-keyword">const</span> spotLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SpotLight</span>(<span class="hljs-number">0x78ff00</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">0.1</span> , <span class="hljs-number">0.25</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// 聚光灯 颜色 强度 距离 散射角度 散射角度衰减 衰减强度</span><br>spotLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>)<br>spotLight.<span class="hljs-property">target</span> = box <span class="hljs-comment">// 指向对象中心点 对准</span><br>scene.<span class="hljs-title function_">add</span>(spotLight)<br><br><span class="hljs-comment">/** </span><br><span class="hljs-comment"> * 显示光源位置 灯光辅助帮助功能</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> hemisphereLightHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">HemisphereLightHelper</span>(hemisphereLight, <span class="hljs-number">0.2</span>) <span class="hljs-comment">// 渐变光</span><br>scene.<span class="hljs-title function_">add</span>(hemisphereLightHelper)<br><br><span class="hljs-keyword">const</span> directionalLightHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLightHelper</span>(directionalLight, <span class="hljs-number">0.2</span>) <span class="hljs-comment">// 平行光</span><br>scene.<span class="hljs-title function_">add</span>(directionalLightHelper)<br><br><span class="hljs-keyword">const</span> pointLightHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLightHelper</span>(pointLight, <span class="hljs-number">0.2</span>) <span class="hljs-comment">// 点光源</span><br>scene.<span class="hljs-title function_">add</span>(pointLightHelper)<br><br><span class="hljs-keyword">const</span> spotLightHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SpotLightHelper</span>(spotLight) <span class="hljs-comment">// 聚光灯</span><br>scene.<span class="hljs-title function_">add</span>(spotLightHelper)<br><br><span class="hljs-keyword">const</span> rectAreaLightHelper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RectAreaLightHelper</span>(rectAreaLight) <span class="hljs-comment">// 平面光光源</span><br>scene.<span class="hljs-title function_">add</span>(rectAreaLightHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 坐标轴 缩放倍率</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视口宽高</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建相机 视野角度 宽高比例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">100</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 相机坐标</span><br><span class="hljs-comment"> */</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">2</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加</span><br><span class="hljs-comment"> */</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>()<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-comment">// y轴原地旋转</span><br>  <span class="hljs-keyword">const</span> elapsedTime = clock.<span class="hljs-title function_">getElapsedTime</span>()<br>  sphere.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.1</span> * elapsedTime<br>  plane.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.1</span> * elapsedTime<br>  torus.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.1</span> * elapsedTime<br>  box.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0.1</span> * elapsedTime<br>  <span class="hljs-comment">// x轴原地旋转</span><br>  sphere.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.15</span> * elapsedTime<br>  plane.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.15</span> * elapsedTime<br>  torus.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.15</span> * elapsedTime<br>  box.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0.15</span> * elapsedTime<br><br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br>  <br>  spotLightHelper.<span class="hljs-title function_">update</span>()<br>  <br><br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
      <tag>实时渲染光照</tag>
      
      <tag>烘焙光照</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>11.3D文字，随机散布</title>
    <link href="/2022/09/11/threejs/11-3D%E6%96%87%E5%AD%97%EF%BC%8C%E9%9A%8F%E6%9C%BA%E6%95%A3%E5%B8%83/"/>
    <url>/2022/09/11/threejs/11-3D%E6%96%87%E5%AD%97%EF%BC%8C%E9%9A%8F%E6%9C%BA%E6%95%A3%E5%B8%83/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入three.js</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">FontLoader</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/loaders/FontLoader.js&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">TextGeometry</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/geometries/TextGeometry.js&#x27;</span><br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建画布</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>()<br><span class="hljs-keyword">const</span> matcapTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/matcaps/8.png&#x27;</span>))<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建字体？</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// new THREE.Loader</span><br><span class="hljs-keyword">const</span> fontLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FontLoader</span>()<br><br>fontLoader.<span class="hljs-title function_">load</span>(<br>  <span class="hljs-string">&#x27;/font/YouYuan_Regular.json&#x27;</span>, <span class="hljs-comment">// public 路径下的文件，可以直接调用</span><br>  <span class="hljs-function">(<span class="hljs-params">font</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> textGeometry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextGeometry</span>(<br>      <span class="hljs-string">&#x27;我是刘朝刚&#x27;</span>,<br>      &#123;<br>        font,<br>        <span class="hljs-attr">size</span>: <span class="hljs-number">0.5</span>,<br>        <span class="hljs-attr">height</span>: <span class="hljs-number">0.5</span>,<br>        <span class="hljs-attr">curveSegments</span>: <span class="hljs-number">5</span>,<br>        <span class="hljs-attr">bevelEnabled</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">bevelThickness</span>: <span class="hljs-number">0.03</span>,<br>        <span class="hljs-attr">bevelSize</span>: <span class="hljs-number">0.02</span>,<br>        <span class="hljs-attr">bevelOffset</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-attr">bevelSegments</span>: <span class="hljs-number">4</span><br>      &#125;<br>    )<br>    <span class="hljs-comment">// textGeometry.computeBoundingBox() // 计算边界框 因为默认值为null 边界不是响应式数据需要实时计算</span><br>    <span class="hljs-comment">// textGeometry.translate( // 以自己的边界框为基准减半，可以居中显示，因为文字高低不同有误差</span><br>    <span class="hljs-comment">//   -textGeometry.boundingBox.max.x * 0.5,</span><br>    <span class="hljs-comment">//   -textGeometry.boundingBox.max.y * 0.5,</span><br>    <span class="hljs-comment">//   -textGeometry.boundingBox.max.z * 0.5,</span><br>    <span class="hljs-comment">// )</span><br>    textGeometry.<span class="hljs-title function_">center</span>()<br><br>    <span class="hljs-keyword">const</span> textMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshMatcapMaterial</span>()<br>    textMaterial.<span class="hljs-property">matcap</span> = matcapTexture<br>    <span class="hljs-comment">// textMaterial.wireframe = true</span><br>    <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(textGeometry, textMaterial)<br>    scene.<span class="hljs-title function_">add</span>(text)<br><br>    <span class="hljs-keyword">const</span> donutGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TorusGeometry</span>(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">20</span>, <span class="hljs-number">45</span>)<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>()<br><br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">300</span>; i++) &#123;<br>      <span class="hljs-keyword">const</span> donut = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(donutGeometry, textMaterial)<br><br>      donut.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) *<span class="hljs-number">10</span><br>      donut.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) *<span class="hljs-number">10</span><br>      donut.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) *<span class="hljs-number">10</span><br><br>      donut.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span><br>      donut.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span><br><br>      <span class="hljs-keyword">const</span> scale = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(), <span class="hljs-number">0.2</span>)<br>      donut.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(scale, scale, scale)<br><br>      scene.<span class="hljs-title function_">add</span>(donut)<br>    &#125;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>()<br>  &#125;<br>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 坐标轴 缩放倍率</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视口宽高</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建相机 视野角度 宽高比例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 相机坐标</span><br><span class="hljs-comment"> */</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">3</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加</span><br><span class="hljs-comment"> */</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br>  <br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
      <tag>贴图</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>10.3D贴图应用，反光背景图应用</title>
    <link href="/2022/09/10/threejs/10-3D%E8%B4%B4%E5%9B%BE%E5%BA%94%E7%94%A8%EF%BC%8C%E5%8F%8D%E5%85%89%E8%83%8C%E6%99%AF%E5%9B%BE%E5%BA%94%E7%94%A8/"/>
    <url>/2022/09/10/threejs/10-3D%E8%B4%B4%E5%9B%BE%E5%BA%94%E7%94%A8%EF%BC%8C%E5%8F%8D%E5%85%89%E8%83%8C%E6%99%AF%E5%9B%BE%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 导入three.js</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 调试组件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dat.gui&#x27;</span><br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建调试组件</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> dat.<span class="hljs-title function_">GUI</span>()<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 载入纹理</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>()<br><span class="hljs-keyword">const</span> cubeTextureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">CubeTextureLoader</span>()<br><br><span class="hljs-keyword">const</span> doorColorTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/color.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorAlphaTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/alpha.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorAmbientOccTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/ambientOcclusion.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorHeightTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/height.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorNormalTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/normal.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorMetalnessTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/metalness.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> doorRoughnessTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/door/roughness.jpg&#x27;</span>))<br><span class="hljs-keyword">const</span> matcapTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/matcaps/1.png&#x27;</span>))<br><span class="hljs-keyword">const</span> gradientTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/gradients/3.jpg&#x27;</span>))<br>gradientTexture.<span class="hljs-property">minFilter</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">NearestFilter</span> <span class="hljs-comment">// 配合 卡通风格 使用？</span><br>gradientTexture.<span class="hljs-property">magFilter</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">NearestFilter</span> <span class="hljs-comment">// 配合 卡通风格 使用？</span><br>gradientTexture.<span class="hljs-property">generateMipmaps</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 配合 卡通风格 使用 性能优化？</span><br><br><span class="hljs-keyword">const</span> environmentMapTexture = cubeTextureLoader.<span class="hljs-title function_">load</span>([<br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/environmentMaps/4/px.png&#x27;</span>),<br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/environmentMaps/4/nx.png&#x27;</span>),<br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/environmentMaps/4/py.png&#x27;</span>),<br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/environmentMaps/4/ny.png&#x27;</span>),<br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/environmentMaps/4/pz.png&#x27;</span>),<br>  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/environmentMaps/4/nx.png&#x27;</span>),<br>])<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 使用纹理创建材质</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// const material = new THREE.MeshBasicMaterial() // 基本纹理材质</span><br><span class="hljs-comment">// material.map = doorColorTexture // 贴图</span><br><span class="hljs-comment">// material.color = new THREE.Color(&#x27;red&#x27;) // 颜色</span><br><span class="hljs-comment">// material.wireframe = true // 网格线 查看面数</span><br><span class="hljs-comment">// material.transparent = true // 打开透明</span><br><span class="hljs-comment">// material.alphaMap = doorAlphaTexture // 透明度图片 类似 PS 蒙版</span><br><br><span class="hljs-comment">// const material = new THREE.MeshNormalMaterial() // 网格法向量材质 特殊 THREE 材质 七彩 性能好</span><br><span class="hljs-comment">// material.flatShading = true // 按网格进行着色 方块 默认平滑</span><br><br><span class="hljs-comment">// const material = new THREE.MeshMatcapMaterial // 模拟反光材质 需要特殊图片素材</span><br><span class="hljs-comment">// material.matcap = matcapTexture // 反光内容取决于图片</span><br><br><span class="hljs-comment">// const material = new THREE.MeshDepthMaterial // 模拟雾材质 远黑近白</span><br><br><span class="hljs-comment">// 配合 真实光源 使用 单一模型与下面冲突 ↓</span><br><span class="hljs-comment">// const material = new THREE.MeshPhongMaterial() // 光晕</span><br><span class="hljs-comment">// material.shininess = 10 // 强度</span><br><span class="hljs-comment">// material.specular = new THREE.Color(0xff0000) // 颜色</span><br><br><span class="hljs-comment">// 配合 真实光源 使用 选一 单一模型与上面冲突 ↑</span><br><span class="hljs-comment">// const material = new THREE.MeshToonMaterial() // 卡通风格 ?</span><br><span class="hljs-comment">// material.gradientMap = gradientTexture // 渐变纹理</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * !!!标准纹理材质</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// const material = new THREE.MeshStandardMaterial()</span><br><span class="hljs-comment">// material.metalness = 0.45 // 金属度 整体</span><br><span class="hljs-comment">// material.roughness = 0.65 // 金属度 反光</span><br><span class="hljs-comment">// material.map = doorColorTexture // 基本颜色贴图</span><br><span class="hljs-comment">// material.aoMap = doorAmbientOccTexture // ao贴图 缝隙</span><br><span class="hljs-comment">// material.aoMapIntensity = 2 // ao贴图 强度</span><br><span class="hljs-comment">// material.displacementMap = doorHeightTexture // 偏移贴图 创建更多面数 实现层次</span><br><span class="hljs-comment">// material.displacementScale = 0.05 // ao贴图 缩放</span><br><span class="hljs-comment">// material.roughnessMap = doorRoughnessTexture // 金属度贴图</span><br><span class="hljs-comment">// material.normalMap = doorNormalTexture // 法线贴图 配合 偏移贴图 实现光线层次</span><br><span class="hljs-comment">// material.normalScale.set(0.5, 0.5) // 法线贴图 缩放</span><br><span class="hljs-comment">// // material.wireframe = true // 网格线 查看面数</span><br><span class="hljs-comment">// material.transparent = true // 打开透明</span><br><span class="hljs-comment">// material.alphaMap = doorAlphaTexture // 透明度图片 类似 PS 蒙版</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * !!!标准纹理材质 金属镜反光背景图</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>()<br>material.<span class="hljs-property">metalness</span> = <span class="hljs-number">0.7</span><br>material.<span class="hljs-property">roughness</span> = <span class="hljs-number">0.2</span><br>material.<span class="hljs-property">envMap</span> = environmentMapTexture <span class="hljs-comment">// 载入反光背景图片</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加调试组件 UI</span><br><span class="hljs-comment"> */</span><br>gui<br>  .<span class="hljs-title function_">add</span>(material, <span class="hljs-string">&#x27;metalness&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.0001</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;金属度 整体 调整&#x27;</span>)<br>gui<br>  .<span class="hljs-title function_">add</span>(material, <span class="hljs-string">&#x27;roughness&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.0001</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;金属度 反光 调整&#x27;</span>)<br>gui<br>  .<span class="hljs-title function_">add</span>(material, <span class="hljs-string">&#x27;aoMapIntensity&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">10</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.0001</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;ao贴图 强度&#x27;</span>)<br>gui<br>  .<span class="hljs-title function_">add</span>(material, <span class="hljs-string">&#x27;displacementScale&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.0001</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;ao贴图 缩放&#x27;</span>)<br>gui<br>  .<span class="hljs-title function_">add</span>(material.<span class="hljs-property">normalScale</span>, <span class="hljs-string">&#x27;x&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.0001</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;x轴法线贴图 缩放&#x27;</span>)<br>gui<br>  .<span class="hljs-title function_">add</span>(material.<span class="hljs-property">normalScale</span>, <span class="hljs-string">&#x27;y&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(<span class="hljs-number">0</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.0001</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;y轴法线贴图 缩放&#x27;</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建画布</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建模型</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sphere = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SphereGeometry</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">16</span>, <span class="hljs-number">16</span>),<br>  material<br>)<br>sphere.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">1.5</span><br>sphere.<span class="hljs-property">geometry</span>.<span class="hljs-title function_">setAttribute</span>(<br>  <span class="hljs-string">&#x27;uv2&#x27;</span>,<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(sphere.<span class="hljs-property">geometry</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">uv</span>.<span class="hljs-property">array</span>, <span class="hljs-number">2</span>)<br>)<br><span class="hljs-keyword">const</span> plane = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>( <span class="hljs-comment">// 宽，高，x面数。y面数</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>),<br>  <span class="hljs-comment">// new THREE.PlaneGeometry(1, 1, 100, 100),</span><br>  material<br>)<br>plane.<span class="hljs-property">geometry</span>.<span class="hljs-title function_">setAttribute</span>(<br>  <span class="hljs-string">&#x27;uv2&#x27;</span>,<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(plane.<span class="hljs-property">geometry</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">uv</span>.<span class="hljs-property">array</span>, <span class="hljs-number">2</span>)<br>)<br><span class="hljs-keyword">const</span> torus = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TorusGeometry</span>(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">16</span>, <span class="hljs-number">32</span>),<br>  material<br>)<br>torus.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">1.5</span><br>torus.<span class="hljs-property">geometry</span>.<span class="hljs-title function_">setAttribute</span>(<br>  <span class="hljs-string">&#x27;uv2&#x27;</span>,<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(torus.<span class="hljs-property">geometry</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">uv</span>.<span class="hljs-property">array</span>, <span class="hljs-number">2</span>)<br>)<br>scene.<span class="hljs-title function_">add</span>(sphere, plane, torus)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 真实光照 只会从固定位置反射 消耗性能</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.5</span>) <span class="hljs-comment">// 环境光</span><br>scene.<span class="hljs-title function_">add</span>(ambientLight)<br><br><span class="hljs-keyword">const</span> pointLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.5</span>) <span class="hljs-comment">// 点光源</span><br>pointLight.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span><br>pointLight.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">3</span><br>pointLight.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">4</span><br>scene.<span class="hljs-title function_">add</span>(pointLight)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 坐标轴 缩放倍率</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 视口宽高</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建相机 视野角度 宽高比例</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 相机坐标</span><br><span class="hljs-comment"> */</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 添加</span><br><span class="hljs-comment"> */</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-comment">// const clock = new THREE.Clock()</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-comment">// // y轴原地旋转</span><br>  <span class="hljs-comment">// const elapsedTime = clock.getElapsedTime()</span><br>  <span class="hljs-comment">// sphere.rotation.y = 0.1 * elapsedTime</span><br>  <span class="hljs-comment">// plane.rotation.y = 0.1 * elapsedTime</span><br>  <span class="hljs-comment">// torus.rotation.y = 0.1 * elapsedTime</span><br>  <span class="hljs-comment">// // x轴原地旋转</span><br>  <span class="hljs-comment">// sphere.rotation.x = 0.15 * elapsedTime</span><br>  <span class="hljs-comment">// plane.rotation.x = 0.15 * elapsedTime</span><br>  <span class="hljs-comment">// torus.rotation.x = 0.15 * elapsedTime</span><br><br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br>  <br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
      <tag>贴图</tag>
      
      <tag>Ao</tag>
      
      <tag>实时渲染光照</tag>
      
      <tag>实时渲染阴影</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>9.UV展开，过滤器混合模式</title>
    <link href="/2022/09/09/threejs/9-UV%E5%B1%95%E5%BC%80%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%99%A8%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F/"/>
    <url>/2022/09/09/threejs/9-UV%E5%B1%95%E5%BC%80%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%99%A8%E6%B7%B7%E5%90%88%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;canvas class=&quot;fk&quot;&gt;</span><br><span class="hljs-comment">  123456</span><br><span class="hljs-comment">&lt;/canvas&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">// 导入three.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">// 调试组件</span><br><span class="hljs-comment">// import * as dat from &#x27;dat.gui&#x27;</span><br><br><span class="hljs-comment">// 材质贴图</span><br><span class="hljs-keyword">const</span> imageSource = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/emerald.jpg&#x27;</span>)<br><br><span class="hljs-keyword">const</span> loadingManager = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">LoadingManager</span>() <span class="hljs-comment">// 全局事件回调</span><br><span class="hljs-comment">// loadingManager.onStart = () =&gt; &#123; // 初始化</span><br><span class="hljs-comment">//   console.log(&#x27;初始化&#x27;)</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// loadingManager.onLoad = () =&gt; &#123; // 挂载</span><br><span class="hljs-comment">//   console.log(&#x27;挂载&#x27;)</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// loadingManager.onProgress = () =&gt; &#123; // 加载中</span><br><span class="hljs-comment">//   console.log(&#x27;加载中&#x27;)</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// loadingManager.onError = () =&gt; &#123; // 报错</span><br><span class="hljs-comment">//   console.log(&#x27;报错&#x27;)</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>(loadingManager) <span class="hljs-comment">// 不是专属对象，只是工具方法，下面可以多次调用</span><br><span class="hljs-keyword">const</span> colorTexture = textureLoader.<span class="hljs-title function_">load</span>( <span class="hljs-comment">// 专属事件回调</span><br>imageSource,<br><span class="hljs-comment">// () =&gt; &#123; // 初始化</span><br><span class="hljs-comment">//   console.log(&#x27;初始化2&#x27;)</span><br><span class="hljs-comment">// &#125;,</span><br><span class="hljs-comment">// () =&gt; &#123; // 加载中</span><br><span class="hljs-comment">//   console.log(&#x27;加载中2&#x27;)</span><br><span class="hljs-comment">// &#125;,</span><br><span class="hljs-comment">// () =&gt; &#123; // 错误</span><br><span class="hljs-comment">//   console.log(&#x27;错误2&#x27;)</span><br><span class="hljs-comment">// &#125;,</span><br>)<br>  <br><span class="hljs-comment">// UV 展开坐标点</span><br><span class="hljs-comment">// const texture999 = textureLoader.load(imageSource)</span><br><span class="hljs-comment">// colorTexture.repeat.x = 2</span><br><span class="hljs-comment">// colorTexture.repeat.y = 3</span><br><span class="hljs-comment">// colorTexture.wrapS = THREE.RepeatWrapping // 水平平铺</span><br><span class="hljs-comment">// colorTexture.wrapT = THREE.RepeatWrapping // 垂直平铺</span><br><br><span class="hljs-comment">// colorTexture.offset.x = 0.5 // x轴偏移 往左减 相当于右pindding</span><br><span class="hljs-comment">// colorTexture.offset.y = 0.5 // y轴偏移 往下减 相当于左pindding</span><br><br><span class="hljs-comment">// colorTexture.rotation = Math.PI / 4 // 倾斜角度 使用圆周率可以精确角度旋转</span><br><span class="hljs-comment">// colorTexture.center.x = 0.8 // x轴从左上角 距离中心点排偏移</span><br><span class="hljs-comment">// colorTexture.center.y = 0.8 // y轴从左上角 距离中心点排偏移</span><br><br><span class="hljs-comment">// colorTexture.generateMipmaps = false // ？？？</span><br>colorTexture.<span class="hljs-property">minFilter</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">NearestFilter</span> <span class="hljs-comment">// 过滤模式 混合 默认？</span><br><span class="hljs-comment">// colorTexture.magFilter = THREE.LinearFilter // 过滤模式 尖锐 更高的帧率</span><br><br><span class="hljs-comment">// 颜色</span><br><span class="hljs-keyword">const</span> parameters = &#123;<br>  <span class="hljs-attr">color</span>: <span class="hljs-number">0xbad24e</span><br>&#125;<br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;() <span class="hljs-comment">// canvas refs 元素节点</span><br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;() <span class="hljs-comment">// 渲染对象</span><br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;() <span class="hljs-comment">// 调试组件对象</span><br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// 几何体对象</span><br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">map</span>: colorTexture &#125;) <span class="hljs-comment">// 材质对象 颜色 / 贴图</span><br><br><span class="hljs-comment">// console.log(geometry.attributes.uv)</span><br><br><span class="hljs-comment">// 创建调试组件</span><br><span class="hljs-comment">// const gui = new dat.GUI()</span><br><br><span class="hljs-comment">// 创建画布</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br>        <br><span class="hljs-comment">// 创建群组</span><br><span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()<br>group.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br>group.<span class="hljs-property">scale</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>group.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>scene.<span class="hljs-title function_">add</span>(group)<br><br><span class="hljs-comment">// 创建网格</span><br><span class="hljs-keyword">const</span> cubel = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  geometry,<br>  material<br>)<br>group.<span class="hljs-title function_">add</span>(cubel)<br><span class="hljs-keyword">const</span> cubel2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  geometry,<br>  material<br>)<br>cubel2.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel2)<br><span class="hljs-keyword">const</span> cubel3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  geometry,<br>  material<br>)<br>cubel3.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel3)<br><br><br><span class="hljs-comment">// 添加调试组件 对象属性 最小值 最大值 步长</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;x&#x27;, -3, 3, 0.01)</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;y&#x27;, -3, 3, 0.01)</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;z&#x27;, -3, 3, 0.01)</span><br><span class="hljs-comment">// 添加调试组件 链式语法 最小值 最大值 步长 名称</span><br><span class="hljs-comment">// gui</span><br><span class="hljs-comment">//   .add(group.position, &#x27;x&#x27;)</span><br><span class="hljs-comment">//   .min(-3)</span><br><span class="hljs-comment">//   .max(3)</span><br><span class="hljs-comment">//   .step(0.01)</span><br><span class="hljs-comment">//   .name(&#x27;我是x轴组件名称name&#x27;)</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;y&#x27;)</span><br><span class="hljs-comment">//   .min(-3)</span><br><span class="hljs-comment">//   .max(3)</span><br><span class="hljs-comment">//   .step(0.01)</span><br><span class="hljs-comment">//   .name(&#x27;我是y轴组件名称name&#x27;)</span><br><span class="hljs-comment">// gui</span><br><span class="hljs-comment">//   .add(group.position, &#x27;z&#x27;)</span><br><span class="hljs-comment">//   .min(-3)</span><br><span class="hljs-comment">//   .max(3)</span><br><span class="hljs-comment">//   .step(0.01)</span><br><span class="hljs-comment">//   .name(&#x27;我是z轴组件名称name&#x27;)</span><br><br><span class="hljs-comment">// // 添加调色板 </span><br><span class="hljs-comment">// gui</span><br><span class="hljs-comment">//   .addColor(parameters, &#x27;color&#x27;)</span><br><span class="hljs-comment">//   .onChange(() =&gt; &#123;</span><br><span class="hljs-comment">//     material.color.set(parameters.color)</span><br><span class="hljs-comment">//   &#125;)</span><br><br><br><span class="hljs-comment">// 坐标轴 缩放倍率</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">// 视口宽高</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">// 创建相机 视野角度 宽高比例</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">// 相机坐标</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">// 添加</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br>  <br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 双击打开全屏 不支持 Safari 苹果浏览器</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dblclick&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">document</span>.<span class="hljs-property">fullscreenElement</span>) &#123;<br>      _fk.<span class="hljs-property">value</span>.<span class="hljs-title function_">requestFullscreen</span>()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">exitFullscreen</span>()<br>    &#125;<br>  &#125;)<br><br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
      <tag>贴图</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>8.贴图</title>
    <link href="/2022/09/08/threejs/8-%E8%B4%B4%E5%9B%BE/"/>
    <url>/2022/09/08/threejs/8-%E8%B4%B4%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;canvas class=&quot;fk&quot;&gt;</span><br><span class="hljs-comment">  123456</span><br><span class="hljs-comment">&lt;/canvas&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">// 导入three.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">// 调试组件</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dat.gui&#x27;</span><br><br><span class="hljs-comment">// 材质贴图</span><br><span class="hljs-keyword">const</span> imageSource = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@/assets/marble.jpg&#x27;</span>)<br><span class="hljs-keyword">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>()<br><span class="hljs-keyword">const</span> texture = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Texture</span>(image)<br>image.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 图片加载完成时，更新图片，如有撕裂问题需要使用 my-web2 的预加载方案</span><br>  texture.<span class="hljs-property">needsUpdate</span> = <span class="hljs-literal">true</span><br>&#125;<br>image.<span class="hljs-property">src</span> = imageSource<br><br><span class="hljs-comment">// 颜色</span><br><span class="hljs-keyword">const</span> parameters = &#123;<br>  <span class="hljs-attr">color</span>: <span class="hljs-number">0xbad24e</span><br>&#125;<br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">map</span>: texture &#125;)<br><br><span class="hljs-comment">// 创建调试组件</span><br><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> dat.<span class="hljs-title function_">GUI</span>()<br><br><span class="hljs-comment">// 创建画布</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">// 创建群组</span><br><span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()<br>group.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>group.<span class="hljs-property">scale</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>scene.<span class="hljs-title function_">add</span>(group)<br><br><span class="hljs-comment">// 创建网格</span><br><span class="hljs-keyword">const</span> cubel = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  geometry,<br>  material<br>)<br>group.<span class="hljs-title function_">add</span>(cubel)<br><span class="hljs-keyword">const</span> cubel2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  geometry,<br>  material<br>)<br>cubel2.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel2)<br><span class="hljs-keyword">const</span> cubel3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  geometry,<br>  material<br>)<br>cubel3.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel3)<br><br><br><span class="hljs-comment">// 添加调试组件 对象属性 最小值 最大值 步长</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;x&#x27;, -3, 3, 0.01)</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;y&#x27;, -3, 3, 0.01)</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;z&#x27;, -3, 3, 0.01)</span><br><span class="hljs-comment">// 添加调试组件 链式语法 最小值 最大值 步长 名称</span><br>gui<br>  .<span class="hljs-title function_">add</span>(group.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;x&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(-<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.01</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;我是x轴组件名称name&#x27;</span>)<br>gui.<span class="hljs-title function_">add</span>(group.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;y&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(-<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.01</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;我是y轴组件名称name&#x27;</span>)<br>gui<br>  .<span class="hljs-title function_">add</span>(group.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;z&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(-<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.01</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;我是z轴组件名称name&#x27;</span>)<br><br><span class="hljs-comment">// 添加调色板 </span><br>gui<br>  .<span class="hljs-title function_">addColor</span>(parameters, <span class="hljs-string">&#x27;color&#x27;</span>)<br>  .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    material.<span class="hljs-property">color</span>.<span class="hljs-title function_">set</span>(parameters.<span class="hljs-property">color</span>)<br>  &#125;)<br><br><br><span class="hljs-comment">// 坐标轴 缩放倍率</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">// 视口宽高</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">// 创建相机 视野角度 宽高比例</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">// 相机坐标</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">// 添加</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br>  <br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 双击打开全屏 不支持 Safari 苹果浏览器</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dblclick&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">document</span>.<span class="hljs-property">fullscreenElement</span>) &#123;<br>      _fk.<span class="hljs-property">value</span>.<span class="hljs-title function_">requestFullscreen</span>()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">exitFullscreen</span>()<br>    &#125;<br>  &#125;)<br><br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
      <tag>贴图</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>7.调试组件 UI</title>
    <link href="/2022/09/07/threejs/7-%E8%B0%83%E8%AF%95%E7%BB%84%E4%BB%B6-UI/"/>
    <url>/2022/09/07/threejs/7-%E8%B0%83%E8%AF%95%E7%BB%84%E4%BB%B6-UI/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">// 导入three.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><span class="hljs-comment">// 调试组件</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;dat.gui&#x27;</span><br><br><span class="hljs-comment">// 颜色</span><br><span class="hljs-keyword">const</span> parameters = &#123;<br>  <span class="hljs-attr">color</span>: <span class="hljs-number">0xbad24e</span><br>&#125;<br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: parameters.<span class="hljs-property">color</span> &#125;)<br><br><span class="hljs-comment">// 创建调试组件</span><br><span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> dat.<span class="hljs-title function_">GUI</span>()<br><br><span class="hljs-comment">// 创建画布</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">// 创建群组</span><br><span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()<br>group.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>group.<span class="hljs-property">scale</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>scene.<span class="hljs-title function_">add</span>(group)<br><br><span class="hljs-comment">// 创建网格</span><br><span class="hljs-keyword">const</span> cubel = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  geometry,<br>  material<br>)<br>group.<span class="hljs-title function_">add</span>(cubel)<br><span class="hljs-keyword">const</span> cubel2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  geometry,<br>  material<br>)<br>cubel2.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel2)<br><span class="hljs-keyword">const</span> cubel3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  geometry,<br>  material<br>)<br>cubel3.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel3)<br><br><br><span class="hljs-comment">// 添加调试组件 对象属性 最小值 最大值 步长</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;x&#x27;, -3, 3, 0.01)</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;y&#x27;, -3, 3, 0.01)</span><br><span class="hljs-comment">// gui.add(group.position, &#x27;z&#x27;, -3, 3, 0.01)</span><br><span class="hljs-comment">// 添加调试组件 链式语法 最小值 最大值 步长 名称</span><br>gui<br>  .<span class="hljs-title function_">add</span>(group.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;x&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(-<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.01</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;我是x轴组件名称name&#x27;</span>)<br>gui.<span class="hljs-title function_">add</span>(group.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;y&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(-<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.01</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;我是y轴组件名称name&#x27;</span>)<br>gui<br>  .<span class="hljs-title function_">add</span>(group.<span class="hljs-property">position</span>, <span class="hljs-string">&#x27;z&#x27;</span>)<br>  .<span class="hljs-title function_">min</span>(-<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">max</span>(<span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">step</span>(<span class="hljs-number">0.01</span>)<br>  .<span class="hljs-title function_">name</span>(<span class="hljs-string">&#x27;我是z轴组件名称name&#x27;</span>)<br><br><span class="hljs-comment">// 添加调色板 </span><br>gui<br>  .<span class="hljs-title function_">addColor</span>(parameters, <span class="hljs-string">&#x27;color&#x27;</span>)<br>  .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    material.<span class="hljs-property">color</span>.<span class="hljs-title function_">set</span>(parameters.<span class="hljs-property">color</span>)<br>  &#125;)<br><br><br><span class="hljs-comment">// 坐标轴 缩放倍率</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">// 视口宽高</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">// 创建相机 视野角度 宽高比例</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">// 相机坐标</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">// 添加</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br>  <br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 双击打开全屏 不支持 Safari 苹果浏览器</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dblclick&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">document</span>.<span class="hljs-property">fullscreenElement</span>) &#123;<br>      _fk.<span class="hljs-property">value</span>.<span class="hljs-title function_">requestFullscreen</span>()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">exitFullscreen</span>()<br>    &#125;<br>  &#125;)<br><br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
      <tag>dat.gui</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>6.双击打开全屏</title>
    <link href="/2022/09/06/threejs/6-%E5%8F%8C%E5%87%BB%E6%89%93%E5%BC%80%E5%85%A8%E5%B1%8F/"/>
    <url>/2022/09/06/threejs/6-%E5%8F%8C%E5%87%BB%E6%89%93%E5%BC%80%E5%85%A8%E5%B1%8F/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;canvas class=&quot;fk&quot;&gt;</span><br><span class="hljs-comment">  123456</span><br><span class="hljs-comment">&lt;/canvas&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">// 导入three.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">// 创建画布</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">// 创建群组</span><br><span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()<br>group.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>group.<span class="hljs-property">scale</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>scene.<span class="hljs-title function_">add</span>(group)<br><br><span class="hljs-comment">// 创建网格</span><br><span class="hljs-keyword">const</span> cubel = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0xff0000</span> &#125;)<br>)<br>group.<span class="hljs-title function_">add</span>(cubel)<br><span class="hljs-keyword">const</span> cubel2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> &#125;)<br>)<br>cubel2.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel2)<br><span class="hljs-keyword">const</span> cubel3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x0000ff</span> &#125;)<br>)<br>cubel3.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel3)<br><br><span class="hljs-comment">// 坐标轴 缩放倍率</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">// 视口宽高</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">// 创建相机 视野角度 宽高比例</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">// 相机坐标</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">// 添加</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br>  <br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 双击打开全屏 不支持 Safari 苹果浏览器</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dblclick&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">document</span>.<span class="hljs-property">fullscreenElement</span>) &#123;<br>      _fk.<span class="hljs-property">value</span>.<span class="hljs-title function_">requestFullscreen</span>()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">exitFullscreen</span>()<br>    &#125;<br>  &#125;)<br><br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>5.阻尼相机移动，多个移动方法之一</title>
    <link href="/2022/09/05/threejs/5-%E9%98%BB%E5%B0%BC%E7%9B%B8%E6%9C%BA%E7%A7%BB%E5%8A%A8%EF%BC%8C%E5%A4%9A%E4%B8%AA%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E4%B9%8B%E4%B8%80/"/>
    <url>/2022/09/05/threejs/5-%E9%98%BB%E5%B0%BC%E7%9B%B8%E6%9C%BA%E7%A7%BB%E5%8A%A8%EF%BC%8C%E5%A4%9A%E4%B8%AA%E7%A7%BB%E5%8A%A8%E6%96%B9%E6%B3%95%E4%B9%8B%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;canvas class=&quot;fk&quot;&gt;</span><br><span class="hljs-comment">  123456</span><br><span class="hljs-comment">&lt;/canvas&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">// 导入three.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">OrbitControls</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span><br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><span class="hljs-keyword">const</span> controls = ref&lt;<span class="hljs-title class_">OrbitControls</span>&gt;()<br><br><span class="hljs-comment">// 创建画布</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">// 创建群组</span><br><span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()<br>group.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>group.<span class="hljs-property">scale</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>scene.<span class="hljs-title function_">add</span>(group)<br><br><span class="hljs-comment">// 创建网格</span><br><span class="hljs-keyword">const</span> cubel = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0xff0000</span> &#125;)<br>)<br>group.<span class="hljs-title function_">add</span>(cubel)<br><span class="hljs-keyword">const</span> cubel2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> &#125;)<br>)<br>cubel2.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel2)<br><span class="hljs-keyword">const</span> cubel3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x0000ff</span> &#125;)<br>)<br>cubel3.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel3)<br><br><span class="hljs-comment">// 坐标轴 缩放倍率</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">// 视口宽高</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>&#125;<br><br><span class="hljs-comment">// 创建相机 视野角度 宽高比例</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">// 相机坐标</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">// 添加</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-title function_">update</span>()<br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br>  <br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 相机阻尼移动 相机 画布</span><br>  controls.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, _fk.<span class="hljs-property">value</span>)<br>  controls.<span class="hljs-property">value</span>.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 设置像素比率</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))<br><br>  <span class="hljs-comment">// 响应式画布</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 更新分辨率</span><br>    sizes.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span><br>    sizes.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br><br>    <span class="hljs-comment">// 更新摄像机</span><br>    camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span><br>    camera.<span class="hljs-title function_">updateProjectionMatrix</span>()<br><br>    <span class="hljs-comment">// 渲染</span><br>    renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br>  &#125;)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;style lang=&#x27;scss&#x27;&gt;<br>* &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>4.动画移动</title>
    <link href="/2022/09/04/threejs/4-%E5%8A%A8%E7%94%BB%E7%A7%BB%E5%8A%A8/"/>
    <url>/2022/09/04/threejs/4-%E5%8A%A8%E7%94%BB%E7%A7%BB%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;canvas class=&quot;fk&quot;&gt;</span><br><span class="hljs-comment">  123456</span><br><span class="hljs-comment">&lt;/canvas&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">// 导入three.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><span class="hljs-comment">// 导入动画</span><br><span class="hljs-keyword">import</span> gsap <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;gsap&#x27;</span><br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><span class="hljs-keyword">const</span> renderer = ref&lt;<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">WebGLRenderer</span>&gt;()<br><br><span class="hljs-comment">// 创建画布</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">// 创建群组</span><br><span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()<br>group.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>group.<span class="hljs-property">scale</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>scene.<span class="hljs-title function_">add</span>(group)<br><br><span class="hljs-comment">// 创建网格</span><br><span class="hljs-keyword">const</span> cubel = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0xff0000</span> &#125;)<br>)<br>group.<span class="hljs-title function_">add</span>(cubel)<br><span class="hljs-keyword">const</span> cubel2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> &#125;)<br>)<br>cubel2.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel2)<br><span class="hljs-keyword">const</span> cubel3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x0000ff</span> &#125;)<br>)<br>cubel3.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel3)<br><br><span class="hljs-comment">// 坐标轴 缩放倍率</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>()<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">// 视口宽高</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-number">600</span><br>&#125;<br><br><span class="hljs-comment">// 创建相机 视野角度 宽高比例</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">// 相机坐标</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">3</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">// 添加</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-comment">// 动画时间节点</span><br><span class="hljs-comment">// const clock = new THREE.Clock()</span><br><br>gsap.<span class="hljs-title function_">to</span>(group.<span class="hljs-property">position</span>, &#123; <span class="hljs-attr">duration</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">delay</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">2</span> &#125;)<br>gsap.<span class="hljs-title function_">to</span>(group.<span class="hljs-property">position</span>, &#123; <span class="hljs-attr">duration</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">delay</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">0</span> &#125;)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-comment">// 自定义旋转移动方法</span><br>  <span class="hljs-comment">// 当前时间</span><br>  <span class="hljs-comment">// const elapsedTime = clock.getElapsedTime()</span><br><br>  <span class="hljs-comment">// 物品旋转</span><br>  <span class="hljs-comment">// group.position.y = Math.sin(elapsedTime)</span><br>  <span class="hljs-comment">// group.position.x = Math.cos(elapsedTime)</span><br><br>  <span class="hljs-comment">// 相机旋转</span><br>  <span class="hljs-comment">// camera.position.y = Math.sin(elapsedTime)</span><br>  <span class="hljs-comment">// camera.position.x = Math.cos(elapsedTime)</span><br>  <span class="hljs-comment">// camera.lookAt(group.position)</span><br><br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">render</span>(scene, camera)<br>  <span class="hljs-comment">// 下一帧执行</span><br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)<br>&#125;<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 挂载</span><br>  renderer.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-property">value</span>.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-title function_">tick</span>()<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>3.群组</title>
    <link href="/2022/09/03/threejs/3-%E7%BE%A4%E7%BB%84/"/>
    <url>/2022/09/03/threejs/3-%E7%BE%A4%E7%BB%84/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;canvas class=&quot;fk&quot;&gt;</span><br><span class="hljs-comment">  123456</span><br><span class="hljs-comment">&lt;/canvas&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">// 导入three.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><br><span class="hljs-comment">// 创建画布</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">// 创建群组</span><br><span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()<br>group.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>group.<span class="hljs-property">scale</span>.<span class="hljs-property">y</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br>scene.<span class="hljs-title function_">add</span>(group)<br><br><span class="hljs-comment">// 创建网格</span><br><span class="hljs-keyword">const</span> cubel = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0xff0000</span> &#125;)<br>)<br>group.<span class="hljs-title function_">add</span>(cubel)<br><span class="hljs-keyword">const</span> cubel2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> &#125;)<br>)<br>cubel2.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -<span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel2)<br><span class="hljs-keyword">const</span> cubel3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0x0000ff</span> &#125;)<br>)<br>cubel3.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span><br>group.<span class="hljs-title function_">add</span>(cubel3)<br><br><span class="hljs-comment">// 坐标轴 缩放倍率</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>()<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">// 视口宽高</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-number">600</span><br>&#125;<br><br><span class="hljs-comment">// 创建相机 视野角度 宽高比例</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">// 相机坐标</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">3</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">// 添加</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 挂载</span><br>  <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2.旋转</title>
    <link href="/2022/09/02/threejs/2-%E6%97%8B%E8%BD%AC/"/>
    <url>/2022/09/02/threejs/2-%E6%97%8B%E8%BD%AC/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;canvas class=&quot;fk&quot;&gt;</span><br><span class="hljs-comment">  123456</span><br><span class="hljs-comment">&lt;/canvas&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">// 导入three.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><br><span class="hljs-comment">// 创建画布</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">// 创建正方形</span><br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><br><span class="hljs-comment">// 颜色</span><br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;#cccccc&#x27;</span> &#125;)<br><span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material)<br><br><span class="hljs-comment">// 正方形坐标</span><br><span class="hljs-comment">// mesh.position.x = 0.7</span><br><span class="hljs-comment">// mesh.position.y = -0.6</span><br><span class="hljs-comment">// mesh.position.z = 1</span><br>mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0.7</span>, -<span class="hljs-number">0.6</span>, <span class="hljs-number">1</span>)<br><br><span class="hljs-comment">// 正方形缩放</span><br><span class="hljs-comment">// mesh.scale.x = 2</span><br><span class="hljs-comment">// mesh.scale.y = 0.5</span><br><span class="hljs-comment">// mesh.scale.z = 0.5</span><br>mesh.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">2</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>)<br><br><span class="hljs-comment">// 旋转</span><br><span class="hljs-comment">// 旋转顺序</span><br>mesh.<span class="hljs-property">rotation</span>.<span class="hljs-title function_">reorder</span>(<span class="hljs-string">&#x27;YXZ&#x27;</span>)<br>mesh.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span><br>mesh.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span><br><br><span class="hljs-comment">// 添加正方形到画布中</span><br>scene.<span class="hljs-title function_">add</span>(mesh)<br><br><span class="hljs-comment">// 正方形回到 1</span><br><span class="hljs-comment">// mesh.position.normalize()</span><br><br><span class="hljs-comment">// 正方形偏移量</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">length</span>())<br><br><span class="hljs-comment">// 坐标轴 缩放倍率</span><br><span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">2</span>)<br>scene.<span class="hljs-title function_">add</span>(axesHelper)<br><br><span class="hljs-comment">// 视口宽高</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-number">600</span><br>&#125;<br><br><span class="hljs-comment">// 创建相机 视野角度 宽高比例</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">// 相机坐标</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">3</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">0</span><br><br><span class="hljs-comment">// 添加</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br>camera.<span class="hljs-title function_">lookAt</span>(mesh.<span class="hljs-property">position</span>)<br><br><span class="hljs-comment">// 相机距离正方形偏移量</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">distanceTo</span>(camera.<span class="hljs-property">position</span>))<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 挂载</span><br>  <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>1.正方形</title>
    <link href="/2022/09/01/threejs/1-%E6%AD%A3%E6%96%B9%E5%BD%A2/"/>
    <url>/2022/09/01/threejs/1-%E6%AD%A3%E6%96%B9%E5%BD%A2/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;webgl&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;_fk&quot;</span>&gt;</span><br>  123456<br><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br><span class="hljs-comment">&lt;!-- &lt;canvas class=&quot;fk&quot;&gt;</span><br><span class="hljs-comment">  123456</span><br><span class="hljs-comment">&lt;/canvas&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;script lang=<span class="hljs-string">&#x27;ts&#x27;</span> setup&gt;<br><span class="hljs-keyword">import</span> &#123; ref, reactive, onMounted &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-comment">// 导入three.js</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;three&#x27;</span><br><br><span class="hljs-keyword">const</span> _fk = ref&lt;<span class="hljs-title class_">HTMLCanvasElement</span>&gt;()<br><br><span class="hljs-comment">// 创建画布</span><br><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()<br><br><span class="hljs-comment">// 创建正方形</span><br><span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br><br><span class="hljs-comment">// 颜色</span><br><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>(&#123; <span class="hljs-attr">color</span>: <span class="hljs-number">0xff0000</span> &#125;)<br><span class="hljs-comment">// const material = new THREE.MeshBasicMaterial(&#123; color: &#x27;#cccccc&#x27; &#125;)</span><br><span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material)<br><br><span class="hljs-comment">// 添加正方形到画布中</span><br>scene.<span class="hljs-title function_">add</span>(mesh)<br><br><span class="hljs-comment">// 视口宽高</span><br><span class="hljs-keyword">const</span> sizes = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-number">600</span><br>&#125;<br><br><span class="hljs-comment">// 创建相机 视野角度 宽高比例</span><br><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>)<br><br><span class="hljs-comment">// 相机坐标</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">3</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span><br>camera.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span><br><br><span class="hljs-comment">// 添加</span><br>scene.<span class="hljs-title function_">add</span>(camera)<br><br><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// // 使用querySelector方法获取dom节点</span><br>  <span class="hljs-comment">// const canvas = document.querySelector(&#x27;.webgl&#x27;)</span><br><br>  <span class="hljs-comment">// 挂载</span><br>  <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>(&#123;<br>    <span class="hljs-attr">canvas</span>: _fk.<span class="hljs-property">value</span><br>  &#125;)<br>  <span class="hljs-comment">// const renderer = new THREE.WebGLRenderer(&#123;</span><br>  <span class="hljs-comment">//   canvas</span><br>  <span class="hljs-comment">// &#125;)</span><br><br>  <span class="hljs-comment">// 设置宽高</span><br>  renderer.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)<br><br>  <span class="hljs-comment">// 渲染</span><br>  renderer.<span class="hljs-title function_">render</span>(scene, camera)<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网页3D渲染</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Three.js</tag>
      
      <tag>Vue3.js</tag>
      
      <tag>基本几何体</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
